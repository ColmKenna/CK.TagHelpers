@model EditArrayAttributesViewModel

@{
    ViewData["Title"] = "EditArray - Attributes and Configuration";
}

<div class="example-page">
    <h1>@ViewData["Title"]</h1>
    <p class="page-description">
        Each example focuses on a specific attribute set so you can see how configuration affects behavior.
    </p>

    <nav class="example-nav">
        <a asp-controller="TagHelperExamples" asp-action="Index">&larr; Back to EditArray examples</a>
    </nav>

    <section class="example-section" id="template-and-add">
        <h2>Template and add button</h2>
        <p class="example-description">
            Enable the template and add button to let users create new items dynamically.
        </p>

        <div class="example-container row g-3">
            <div class="example-rendered col-lg-6">
                <h3 class="h6">Result</h3>
                <edit-array asp-array-id="attr-template"
                            asp-items="Model.TemplateMembers"
                            asp-view-name="~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml"
                            asp-display-view-name="~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml"
                            asp-display-mode="true"
                            asp-template="true"
                            asp-add-button="true"
                            asp-add-text="Add teammate">
                </edit-array>
            </div>
            <div class="example-source col-lg-6">
                <h3 class="h6">Source</h3>
                <pre><code class="language-cshtml">@Html.Raw("&lt;edit-array asp-array-id=\"attr-template\"\n            asp-items=\"Model.TemplateMembers\"\n            asp-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml\"\n            asp-display-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml\"\n            asp-display-mode=\"true\"\n            asp-template=\"true\"\n            asp-add-button=\"true\"\n            asp-add-text=\"Add teammate\"&gt;\n&lt;/edit-array&gt;")</code></pre>
            </div>
        </div>
    </section>

    <section class="example-section" id="custom-styling">
        <h2>Custom styling classes</h2>
        <p class="example-description">
            Override container, item, and button classes with Bootstrap utility classes.
        </p>

        <div class="example-container row g-3">
            <div class="example-rendered col-lg-6">
                <h3 class="h6">Result</h3>
                <edit-array asp-array-id="attr-styles"
                            asp-items="Model.StyledMembers"
                            asp-view-name="~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml"
                            asp-display-view-name="~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml"
                            asp-display-mode="true"
                            asp-container-class="border border-warning rounded p-3 bg-light"
                            asp-item-class="border rounded p-2 mb-2"
                            asp-button-class="btn btn-outline-primary">
                </edit-array>
            </div>
            <div class="example-source col-lg-6">
                <h3 class="h6">Source</h3>
                <pre><code class="language-cshtml">@Html.Raw("&lt;edit-array asp-array-id=\"attr-styles\"\n            asp-items=\"Model.StyledMembers\"\n            asp-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml\"\n            asp-display-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml\"\n            asp-display-mode=\"true\"\n            asp-container-class=\"border border-warning rounded p-3 bg-light\"\n            asp-item-class=\"border rounded p-2 mb-2\"\n            asp-button-class=\"btn btn-outline-primary\"&gt;\n&lt;/edit-array&gt;")</code></pre>
            </div>
        </div>
    </section>

    <section class="example-section" id="reordering">
        <h2>Reordering controls</h2>
        <p class="example-description">
            Enable reordering and customize the move button text and classes.
        </p>

        <div class="example-container row g-3">
            <div class="example-rendered col-lg-6">
                <h3 class="h6">Result</h3>
                <edit-array asp-array-id="attr-reorder"
                            asp-items="Model.ReorderMembers"
                            asp-view-name="~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml"
                            asp-display-view-name="~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml"
                            asp-display-mode="true"
                            asp-enable-reordering="true"
                            asp-reorder-button-class="btn btn-outline-dark btn-sm"
                            asp-move-up-text="Up"
                            asp-move-down-text="Down">
                </edit-array>
            </div>
            <div class="example-source col-lg-6">
                <h3 class="h6">Source</h3>
                <pre><code class="language-cshtml">@Html.Raw("&lt;edit-array asp-array-id=\"attr-reorder\"\n            asp-items=\"Model.ReorderMembers\"\n            asp-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml\"\n            asp-display-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml\"\n            asp-display-mode=\"true\"\n            asp-enable-reordering=\"true\"\n            asp-reorder-button-class=\"btn btn-outline-dark btn-sm\"\n            asp-move-up-text=\"Up\"\n            asp-move-down-text=\"Down\"&gt;\n&lt;/edit-array&gt;")</code></pre>
            </div>
        </div>
    </section>

    <section class="example-section" id="custom-button-text">
        <h2>Custom button text</h2>
        <p class="example-description">
            Replace the default labels for edit, delete, undelete, and done actions.
        </p>

        <div class="example-container row g-3">
            <div class="example-rendered col-lg-6">
                <h3 class="h6">Result</h3>
                <edit-array asp-array-id="attr-button-text"
                            asp-items="Model.ButtonTextMembers"
                            asp-view-name="~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml"
                            asp-display-view-name="~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml"
                            asp-display-mode="true"
                            asp-edit-text="Open"
                            asp-delete-text="Remove"
                            asp-undelete-text="Restore"
                            asp-done-text="Close">
                </edit-array>
            </div>
            <div class="example-source col-lg-6">
                <h3 class="h6">Source</h3>
                <pre><code class="language-cshtml">@Html.Raw("&lt;edit-array asp-array-id=\"attr-button-text\"\n            asp-items=\"Model.ButtonTextMembers\"\n            asp-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml\"\n            asp-display-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml\"\n            asp-display-mode=\"true\"\n            asp-edit-text=\"Open\"\n            asp-delete-text=\"Remove\"\n            asp-undelete-text=\"Restore\"\n            asp-done-text=\"Close\"&gt;\n&lt;/edit-array&gt;")</code></pre>
            </div>
        </div>
    </section>

    <section class="example-section" id="callbacks">
        <h2>Callback hooks</h2>
        <p class="example-description">
            Use asp-on-update and asp-on-delete to call safe, named JavaScript functions.
        </p>

        <div class="example-container row g-3">
            <div class="example-rendered col-lg-6">
                <h3 class="h6">Result</h3>
                <edit-array asp-array-id="attr-callbacks"
                            asp-items="Model.CallbackMembers"
                            asp-view-name="~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml"
                            asp-display-view-name="~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml"
                            asp-display-mode="true"
                            asp-on-update="handleMemberUpdated"
                            asp-on-delete="handleMemberDeleted">
                </edit-array>
                <div class="alert alert-info mt-2" id="callback-status">Waiting for an update or delete action.</div>
            </div>
            <div class="example-source col-lg-6">
                <h3 class="h6">Source</h3>
                <pre><code class="language-cshtml">@Html.Raw("&lt;edit-array asp-array-id=\"attr-callbacks\"\n            asp-items=\"Model.CallbackMembers\"\n            asp-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml\"\n            asp-display-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml\"\n            asp-display-mode=\"true\"\n            asp-on-update=\"handleMemberUpdated\"\n            asp-on-delete=\"handleMemberDeleted\"&gt;\n&lt;/edit-array&gt;\n&lt;div class=\"alert alert-info mt-2\" id=\"callback-status\"&gt;Waiting for an update or delete action.&lt;/div&gt;")</code></pre>
            </div>
        </div>
    </section>

    <section class="example-section" id="done-hook">
        <h2>Done hook with external validation guard</h2>
        <p class="example-description">
            Plug an external function into asp-on-done to block closing when client-side validation spans contain errors. This keeps the validation logic outside the TagHelper.
        </p>

        <div class="example-container row g-3">
            <div class="example-rendered col-lg-6">
                <h3 class="h6">Result</h3>
                <form id="done-hook-form" novalidate>
                    <edit-array asp-array-id="attr-done-hook"
                                asp-items="Model.DoneHookMembers"
                                asp-view-name="~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml"
                                asp-display-view-name="~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml"
                                asp-display-mode="true"
                                asp-on-done="guardDoneAction">
                    </edit-array>
                </form>
                <div class="alert alert-warning mt-2" id="done-hook-status">Attempt an edit, then click Done.</div>
            </div>
            <div class="example-source col-lg-6">
                <h3 class="h6">Source</h3>
                <pre><code class="language-cshtml">@Html.Raw("&lt;form id=\"done-hook-form\" novalidate&gt;\n    &lt;edit-array asp-array-id=\"attr-done-hook\"\n                asp-items=\"Model.DoneHookMembers\"\n                asp-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml\"\n                asp-display-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml\"\n                asp-display-mode=\"true\"\n                asp-on-done=\"guardDoneAction\"&gt;\n    &lt;/edit-array&gt;\n&lt;/form&gt;\n&lt;div class=\"alert alert-warning mt-2\" id=\"done-hook-status\"&gt;Attempt an edit, then click Done.&lt;/div&gt;")</code></pre>
                <pre class="mt-2"><code class="language-javascript">@Html.Raw("function guardDoneAction(itemId) {\n    const editScope = document.getElementById(`${itemId}-edit`);\n    const form = editScope ? editScope.closest('form') : null;\n    if (form && typeof $ === 'function' && $.validator && $.validator.unobtrusive) {\n        $.validator.unobtrusive.parse(editScope);\n        const validator = $(form).data('validator') || $(form).validate();\n        const inputs = $(editScope).find(':input');\n        const isValid = inputs.toArray().every(input => validator.element(input));\n        updateDoneHookStatus(isValid);\n        return isValid;\n    }\n\n    // Fallback: inspect validation spans if unobtrusive scripts are missing\n    const spans = editScope ? editScope.querySelectorAll('span[data-valmsg-for]') : [];\n    const hasErrors = Array.from(spans).some(s => (s.textContent && s.textContent.trim()) || s.classList.contains('field-validation-error'));\n    updateDoneHookStatus(!hasErrors);\n    return !hasErrors;\n}\n\nfunction updateDoneHookStatus(isValid) {\n    const status = document.getElementById('done-hook-status');\n    if (!status) return;\n    status.textContent = isValid\n        ? 'Allowed: Done action proceeded.'\n        : 'Blocked: resolve validation errors before closing.';\n    status.className = isValid ? 'alert alert-success mt-2' : 'alert alert-danger mt-2';\n}")</code></pre>
            </div>
        </div>
        <div class="example-notes">
            <strong>Note:</strong> The guard lives entirely in your page script. Returning <code>false</code> keeps the edit container open and prevents the internal Done toggle.
        </div>
    </section>

    <section class="example-section" id="empty-placeholder">
        <h2>Empty placeholder</h2>
        <p class="example-description">
            Use asp-empty-placeholder to render guidance text when there are no items.
        </p>

        <div class="example-container row g-3">
            <div class="example-rendered col-lg-6">
                <h3 class="h6">Result</h3>
                <edit-array asp-array-id="attr-empty"
                            asp-items="Model.EmptyMembers"
                            asp-view-name="~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml"
                            asp-display-view-name="~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml"
                            asp-empty-placeholder="No members yet. Use Add to get started."
                            asp-template="true"
                            asp-add-button="true">
                </edit-array>
            </div>
            <div class="example-source col-lg-6">
                <h3 class="h6">Source</h3>
                <pre><code class="language-cshtml">@Html.Raw("&lt;edit-array asp-array-id=\"attr-empty\"\n            asp-items=\"Model.EmptyMembers\"\n            asp-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonEditor.cshtml\"\n            asp-display-view-name=\"~/Views/TagHelperExamples/EditArray/_PersonDisplay.cshtml\"\n            asp-empty-placeholder=\"No members yet. Use Add to get started.\"\n            asp-template=\"true\"\n            asp-add-button=\"true\"&gt;\n&lt;/edit-array&gt;")</code></pre>
            </div>
        </div>
    </section>
</div>

@section Scripts {
    <script>
        function handleMemberUpdated(itemId) {
            const status = document.getElementById('callback-status');
            if (status) {
                status.textContent = 'Updated item: ' + itemId;
            }
        }

        function handleMemberDeleted(itemId) {
            const status = document.getElementById('callback-status');
            if (status) {
                status.textContent = 'Toggled delete for: ' + itemId;
            }
        }

        function guardDoneAction(itemId) {
            const editScope = document.getElementById(`${itemId}-edit`);
            const form = editScope ? editScope.closest('form') : null;
            if (form && typeof $ === 'function' && $.validator && $.validator.unobtrusive) {
                $.validator.unobtrusive.parse(editScope);
                const validator = $(form).data('validator') || $(form).validate();
                const inputs = $(editScope).find(':input');
                const isValid = inputs.toArray().every(input => validator.element(input));
                updateDoneHookStatus(isValid);
                return isValid;
            }

            const spans = editScope ? editScope.querySelectorAll('span[data-valmsg-for]') : [];
            const hasErrors = Array.from(spans).some(s => (s.textContent && s.textContent.trim()) || s.classList.contains('field-validation-error'));
            updateDoneHookStatus(!hasErrors);
            return !hasErrors;
        }

        function updateDoneHookStatus(isValid) {
            const status = document.getElementById('done-hook-status');
            if (!status) return;
            status.textContent = isValid
                ? 'Allowed: Done action proceeded.'
                : 'Blocked: resolve validation errors before closing.';
            status.className = isValid ? 'alert alert-success mt-2' : 'alert alert-danger mt-2';
        }
    </script>
    <partial name="_ValidationScriptsPartial" />
}
